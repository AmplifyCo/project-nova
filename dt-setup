#!/bin/bash
# Digital Twin Setup - Complete automation
# ONE command to: install Python, dependencies, configure, and run
#
# Usage:
#   ./dt-setup              # First run from repo (self-installs)
#   dt-setup                # After install, run from anywhere
#   dt-setup start          # Start the bot
#   dt-setup run            # Start the bot (alias)

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
INSTALL_DIR="/usr/local/bin"
COMMAND_NAME="dt-setup"

# If running from the install location, look for a stored project directory
if [[ "$SCRIPT_DIR" == "$INSTALL_DIR" ]]; then
    # Check for a stored project path written at install time
    STORED_PROJECT_DIR_FILE="$INSTALL_DIR/.dt-setup-project-dir"
    if [ -f "$STORED_PROJECT_DIR_FILE" ]; then
        SCRIPT_DIR="$(cat "$STORED_PROJECT_DIR_FILE")"
    fi
fi

CONFIGURE_PY="$SCRIPT_DIR/configure.py"
REQUIREMENTS_TXT="$SCRIPT_DIR/requirements.txt"

# Check if configure.py exists
if [ ! -f "$CONFIGURE_PY" ]; then
    echo "Error: configure.py not found at $CONFIGURE_PY"
    echo "  Expected project directory: $SCRIPT_DIR"
    echo "  If you moved the project, re-run: cd <project-dir> && ./dt-setup"
    exit 1
fi

# ============================================
# Check and install Python if needed
# ============================================
check_python() {
    if ! command -v python3 &> /dev/null; then
        echo ""
        echo "âŒ Python 3 is not installed!"
        echo ""
        echo "Installing Python 3..."
        echo ""

        # Detect OS and install Python
        if [[ "$OSTYPE" == "darwin"* ]]; then
            # macOS
            if command -v brew &> /dev/null; then
                brew install python3
            else
                echo "Please install Homebrew first: https://brew.sh"
                echo "Then run: brew install python3"
                exit 1
            fi
        elif [[ -f /etc/os-release ]]; then
            . /etc/os-release
            if [[ "$ID" == "amzn" ]] || [[ "$ID_LIKE" == *"rhel"* ]]; then
                # Amazon Linux / RHEL-based
                sudo yum install python3 -y
            elif [[ "$ID" == "ubuntu" ]] || [[ "$ID" == "debian" ]] || [[ "$ID_LIKE" == *"debian"* ]]; then
                # Debian/Ubuntu
                sudo apt-get update && sudo apt-get install python3 python3-pip -y
            else
                echo "âš ï¸  Unsupported Linux distribution: $ID"
                echo "   Please install Python 3 manually"
                exit 1
            fi
        else
            echo "âš ï¸  Unsupported operating system"
            echo "   Please install Python 3 manually"
            exit 1
        fi

        # Verify installation
        if ! command -v python3 &> /dev/null; then
            echo "âŒ Python 3 installation failed"
            exit 1
        fi

        echo "âœ… Python 3 installed successfully!"
    fi
}

# ============================================
# Check and install cloudflared if needed
# ============================================
check_and_install_cloudflared() {
    if ! command -v cloudflared &> /dev/null; then
        echo ""
        echo "ğŸ“¦ cloudflared not found. Installing Cloudflare Tunnel..."
        echo ""

        # Detect OS and install cloudflared
        if [[ "$OSTYPE" == "darwin"* ]]; then
            # macOS
            if command -v brew &> /dev/null; then
                brew install cloudflared
            else
                echo "âš ï¸  Homebrew not found. Installing via download..."
                curl -L --output /usr/local/bin/cloudflared https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-darwin-amd64
                sudo chmod +x /usr/local/bin/cloudflared
            fi
        elif [[ -f /etc/os-release ]]; then
            . /etc/os-release
            if [[ "$ID" == "amzn" ]] || [[ "$ID_LIKE" == *"rhel"* ]]; then
                # Amazon Linux / RHEL-based
                wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.rpm
                sudo rpm -i cloudflared-linux-amd64.rpm
                rm -f cloudflared-linux-amd64.rpm
            elif [[ "$ID" == "ubuntu" ]] || [[ "$ID" == "debian" ]] || [[ "$ID_LIKE" == *"debian"* ]]; then
                # Debian/Ubuntu
                wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
                sudo dpkg -i cloudflared-linux-amd64.deb
                rm -f cloudflared-linux-amd64.deb
            else
                echo "âš ï¸  Unsupported Linux distribution: $ID"
                echo "   Please install cloudflared manually: https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/"
                return 1
            fi
        else
            echo "âš ï¸  Unsupported operating system"
            echo "   Please install cloudflared manually: https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/"
            return 1
        fi

        # Verify installation
        if ! command -v cloudflared &> /dev/null; then
            echo "âŒ cloudflared installation failed"
            return 1
        fi

        echo "âœ… cloudflared installed successfully!"
    fi
    return 0
}

# ============================================
# Self-installation check
# ============================================
install_globally() {
    echo ""
    echo "ğŸ”§ Installing dt-setup globally..."
    echo "   This allows you to run 'dt-setup' from anywhere (like git, python, npm)"
    echo ""

    # Make script executable
    chmod +x "$0"
    chmod +x "$CONFIGURE_PY"

    # Check if /usr/local/bin exists
    if [ ! -d "$INSTALL_DIR" ]; then
        echo "   Creating $INSTALL_DIR..."
        sudo mkdir -p "$INSTALL_DIR"
    fi

    # Copy script and store the project directory so the global install can find it
    echo "   Copying to $INSTALL_DIR/$COMMAND_NAME"
    if sudo cp "$0" "$INSTALL_DIR/$COMMAND_NAME" && sudo chmod +x "$INSTALL_DIR/$COMMAND_NAME" \
        && echo "$SCRIPT_DIR" | sudo tee "$INSTALL_DIR/.dt-setup-project-dir" > /dev/null; then
        echo ""
        echo "âœ… dt-setup installed successfully!"
        echo "   You can now run 'dt-setup' from any directory"
        echo ""
    else
        echo ""
        echo "âŒ Installation failed. Continuing with local setup..."
        echo ""
        return 1
    fi

    # Configure sudoers for systemd service management (Linux only)
    if [[ -f /etc/os-release ]] && command -v systemctl &> /dev/null; then
        CURRENT_USER=$(whoami)
        SUDOERS_FILE="/etc/sudoers.d/digital-twin"
        echo "ğŸ” Configuring sudo permissions for service management..."
        sudo tee "$SUDOERS_FILE" > /dev/null << SUDOERS_EOF
# Digital Twin - limited sudo for service management
$CURRENT_USER ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /usr/bin/systemctl start digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /usr/bin/systemctl status digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /bin/systemctl restart digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /bin/systemctl start digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /bin/systemctl stop digital-twin
$CURRENT_USER ALL=(ALL) NOPASSWD: /bin/systemctl status digital-twin
SUDOERS_EOF
        sudo chmod 440 "$SUDOERS_FILE"
        echo "âœ… Sudo permissions configured (systemctl for digital-twin only)"
        echo ""
    fi

    return 0
}

# Check if running locally and not installed globally
if [[ "$0" == "./"* ]] || [[ "$0" == *"/dt-setup" && ! -f "$INSTALL_DIR/$COMMAND_NAME" ]]; then
    # Running from local directory and not installed globally
    if [[ "$1" != "--help" && "$1" != "-h" && "$1" != "help" && "$1" != "--skip-install" ]]; then
        echo ""
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "  Welcome to Digital Twin Setup!"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "First-time setup detected."
        echo ""

        read -p "Install dt-setup globally? (recommended) [Y/n]: " install_choice
        install_choice=${install_choice:-Y}

        if [[ "$install_choice" =~ ^[Yy]$ ]]; then
            install_globally
        else
            echo ""
            echo "â­ï¸  Skipping global installation."
            echo "   You can install later with: make install"
            echo ""
        fi
    fi
fi

# ============================================
# Auto-install dependencies if needed
# ============================================
check_and_install_dependencies() {
    # Check if anthropic package is installed (key dependency)
    if ! python3 -c "import anthropic" 2>/dev/null; then
        echo ""
        echo "ğŸ“¦ Dependencies not found. Installing required packages..."
        echo ""

        # Check if requirements.txt exists
        if [ ! -f "$REQUIREMENTS_TXT" ]; then
            echo "âš ï¸  Warning: requirements.txt not found at $REQUIREMENTS_TXT"
            echo "   Skipping dependency installation."
            echo ""
            return
        fi

        # Install dependencies
        echo "Running: pip install -r requirements.txt"
        echo ""

        if python3 -m pip install -r "$REQUIREMENTS_TXT"; then
            echo ""
            echo "âœ… Dependencies installed successfully!"
            echo ""
        else
            echo ""
            echo "âŒ Failed to install dependencies."
            echo "   Please run manually: pip install -r requirements.txt"
            echo ""
            exit 1
        fi
    fi
}

# Check Python installation first (unless --help)
if [[ "$1" != "--help" && "$1" != "-h" && "$1" != "help" ]]; then
    check_python
fi

# Check dependencies before running configuration (unless --help or start/run)
if [[ "$1" != "--help" && "$1" != "-h" && "$1" != "help" && "$1" != "start" && "$1" != "run" ]]; then
    check_and_install_dependencies
fi

# ============================================
# Start bot helper
# ============================================
start_bot_if_requested() {
    # Only offer to start for full setup (not partial configs)
    if [[ "$1" == "" || "$1" == "digital-twin" || "$1" == "all" || "$1" == "full" ]]; then
        echo ""
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        read -p "Start the bot now? [Y/n]: " start_choice
        start_choice=${start_choice:-Y}

        if [[ "$start_choice" =~ ^[Yy]$ ]]; then
            echo ""
            echo "ğŸš€ Starting Digital Twin bot..."
            echo ""

            # Check if we're in the right directory
            if [ -f "$SCRIPT_DIR/src/main.py" ]; then
                cd "$SCRIPT_DIR"
                python3 -m src.main
            else
                echo "âŒ Error: src/main.py not found"
                echo "   Please run manually: python -m src.main"
            fi
        else
            echo ""
            echo "âœ… Setup complete!"
            echo ""
            echo "To start the bot later, run:"
            echo "  dt-setup start"
            echo ""
        fi
    fi
}

# Parse arguments and map to configure.py flags
case "$1" in
    "")
        # No arguments - run full wizard
        python3 "$CONFIGURE_PY"
        start_bot_if_requested ""
        ;;
    "digital-twin"|"all"|"full")
        # Full setup
        python3 "$CONFIGURE_PY"
        start_bot_if_requested "$1"
        ;;
    "core"|"api"|"keys")
        # Core API keys
        python3 "$CONFIGURE_PY" --core-only
        ;;
    "telegram"|"tg")
        # Telegram bot
        python3 "$CONFIGURE_PY" --telegram-only
        ;;
    "email"|"mail")
        # Email configuration
        python3 "$CONFIGURE_PY" --email-only
        ;;
    "calendar"|"cal")
        # Calendar configuration
        python3 "$CONFIGURE_PY" --calendar-only
        ;;
    "tunnel"|"cf"|"cloudflare")
        # Cloudflare Tunnel configuration
        python3 "$CONFIGURE_PY" --tunnel-only
        ;;
    "tunnel-start")
        # Start Cloudflare Tunnel
        echo ""
        echo "ğŸŒ Starting Cloudflare Tunnel..."
        echo ""

        # Check if cloudflared is installed
        if ! command -v cloudflared &> /dev/null; then
            echo "âš ï¸  cloudflared not found. Installing..."
            check_and_install_cloudflared
        fi

        # Check if tunnel token is configured
        if [ -f "$SCRIPT_DIR/.env" ]; then
            TUNNEL_TOKEN=$(grep "^CLOUDFLARE_TUNNEL_TOKEN=" "$SCRIPT_DIR/.env" | cut -d'=' -f2)
            if [ -z "$TUNNEL_TOKEN" ]; then
                echo "âŒ Tunnel token not found in .env file"
                echo "   Run: dt-setup tunnel"
                exit 1
            fi

            # Start tunnel
            echo "Starting tunnel in background..."
            nohup cloudflared tunnel --no-autoupdate run --token "$TUNNEL_TOKEN" > "$SCRIPT_DIR/logs/tunnel.log" 2>&1 &
            echo $! > "$SCRIPT_DIR/tunnel.pid"
            echo "âœ… Tunnel started (PID: $!)"
            echo "   Logs: $SCRIPT_DIR/logs/tunnel.log"
        else
            echo "âŒ .env file not found"
            echo "   Run: dt-setup tunnel"
            exit 1
        fi
        echo ""
        ;;
    "tunnel-stop")
        # Stop Cloudflare Tunnel
        echo ""
        echo "ğŸ›‘ Stopping Cloudflare Tunnel..."
        echo ""

        if [ -f "$SCRIPT_DIR/tunnel.pid" ]; then
            PID=$(cat "$SCRIPT_DIR/tunnel.pid")
            if kill -0 "$PID" 2>/dev/null; then
                kill "$PID"
                rm -f "$SCRIPT_DIR/tunnel.pid"
                echo "âœ… Tunnel stopped (PID: $PID)"
            else
                echo "âš ï¸  Tunnel process not found (stale PID)"
                rm -f "$SCRIPT_DIR/tunnel.pid"
            fi
        elif pgrep -f "cloudflared tunnel" > /dev/null; then
            pkill -f "cloudflared tunnel"
            echo "âœ… Tunnel stopped"
        else
            echo "âš ï¸  Tunnel is not running"
        fi
        echo ""
        ;;
    "tunnel-status")
        # Check Cloudflare Tunnel status
        echo ""
        echo "ğŸŒ Cloudflare Tunnel Status"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""

        if [ -f "$SCRIPT_DIR/tunnel.pid" ]; then
            PID=$(cat "$SCRIPT_DIR/tunnel.pid")
            if kill -0 "$PID" 2>/dev/null; then
                echo "âœ… Status: Running (PID: $PID)"
                ps aux | grep "[c]loudflared"
            else
                echo "âŒ Status: Not running (stale PID)"
                rm -f "$SCRIPT_DIR/tunnel.pid"
            fi
        elif pgrep -f "cloudflared tunnel" > /dev/null; then
            echo "âœ… Status: Running"
            ps aux | grep "[c]loudflared"
        else
            echo "âŒ Status: Not running"
            echo ""
            echo "To start the tunnel:"
            echo "  dt-setup tunnel-start"
        fi
        echo ""
        ;;
    "start"|"run")
        # Start the bot
        echo ""
        echo "ğŸš€ Starting Digital Twin bot..."
        echo ""

        if [ -f "$SCRIPT_DIR/src/main.py" ]; then
            cd "$SCRIPT_DIR"
            python3 -m src.main
        else
            echo "âŒ Error: src/main.py not found"
            echo "   Make sure you're in the digital-twin directory"
            exit 1
        fi
        ;;
    "stop")
        # Stop the bot
        echo ""
        echo "ğŸ›‘ Stopping Digital Twin bot..."
        echo ""

        # Try systemd first
        if systemctl is-active --quiet digital-twin 2>/dev/null; then
            sudo systemctl stop digital-twin
            echo "âœ… Bot stopped (systemd service)"
        elif pgrep -f "python.*src.main" > /dev/null; then
            # Kill Python process
            pkill -f "python.*src.main"
            echo "âœ… Bot stopped (process killed)"
        else
            echo "âš ï¸  Bot is not running"
        fi
        echo ""
        ;;
    "restart")
        # Restart the bot
        echo ""
        echo "ğŸ”„ Restarting Digital Twin bot..."
        echo ""

        # Try systemd first
        if systemctl is-enabled --quiet digital-twin 2>/dev/null; then
            sudo systemctl restart digital-twin
            echo "âœ… Bot restarted (systemd service)"
        else
            # Stop if running
            if pgrep -f "python.*src.main" > /dev/null; then
                pkill -f "python.*src.main"
                sleep 2
            fi

            # Start again
            if [ -f "$SCRIPT_DIR/src/main.py" ]; then
                cd "$SCRIPT_DIR"
                python3 -m src.main &
                echo "âœ… Bot restarted (background process)"
            else
                echo "âŒ Error: src/main.py not found"
                exit 1
            fi
        fi
        echo ""
        ;;
    "status")
        # Check bot status
        echo ""
        echo "ğŸ“Š Digital Twin Status"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""

        # Check systemd
        if systemctl is-active --quiet digital-twin 2>/dev/null; then
            echo "âœ… Status: Running (systemd service)"
            sudo systemctl status digital-twin --no-pager | head -15
        elif pgrep -f "python.*src.main" > /dev/null; then
            echo "âœ… Status: Running (process)"
            ps aux | grep "[p]ython.*src.main"
        else
            echo "âŒ Status: Not running"
            echo ""
            echo "To start the bot:"
            echo "  dt-setup start"
        fi
        echo ""
        ;;
    "auto-update")
        # Auto-update management
        case "$2" in
            "enable")
                # Enable auto-updates
                FREQUENCY="${3:-daily}"
                echo ""
                echo "ğŸ”„ Enabling auto-updates ($FREQUENCY)..."
                echo ""

                # Create systemd timer (if on Linux)
                if command -v systemctl &> /dev/null; then
                    # Determine OnCalendar value based on frequency
                    case "$FREQUENCY" in
                        "hourly")
                            CALENDAR="hourly"
                            ;;
                        "daily"|"nightly")
                            CALENDAR="*-*-* 03:00:00"  # 3 AM daily
                            ;;
                        "weekly")
                            CALENDAR="Sun *-*-* 03:00:00"  # Sunday 3 AM
                            ;;
                        *)
                            echo "âŒ Invalid frequency: $FREQUENCY"
                            echo "   Valid options: hourly, daily, weekly"
                            exit 1
                            ;;
                    esac

                    # Update timer file with chosen frequency
                    TIMER_FILE="/etc/systemd/system/digital-twin-autoupdate.timer"
                    if [ -f "$SCRIPT_DIR/deploy/systemd/digital-twin-autoupdate.timer" ]; then
                        # Copy and modify timer file
                        sudo cp "$SCRIPT_DIR/deploy/systemd/digital-twin-autoupdate.service" /etc/systemd/system/
                        sudo cp "$SCRIPT_DIR/deploy/systemd/digital-twin-autoupdate.timer" /etc/systemd/system/

                        # Update OnCalendar in timer file
                        sudo sed -i "s|OnCalendar=.*|OnCalendar=$CALENDAR|" "$TIMER_FILE"

                        # Reload and enable timer
                        sudo systemctl daemon-reload
                        sudo systemctl enable digital-twin-autoupdate.timer
                        sudo systemctl start digital-twin-autoupdate.timer

                        echo "âœ… Auto-updates enabled ($FREQUENCY)"
                        echo ""
                        echo "Check status:"
                        echo "  dt-setup auto-update status"
                        echo ""
                        echo "Run update now:"
                        echo "  dt-setup auto-update now"
                    else
                        echo "âŒ Timer files not found in deploy/systemd/"
                        exit 1
                    fi
                else
                    echo "âš ï¸  systemd not available"
                    echo "   Auto-updates work best with systemd (Linux)"
                    echo ""
                    echo "Alternative: Set up a cron job manually:"
                    echo "  crontab -e"
                    echo "  Add: 0 3 * * * $SCRIPT_DIR/auto-update.sh"
                fi
                echo ""
                ;;
            "disable")
                # Disable auto-updates
                echo ""
                echo "ğŸ›‘ Disabling auto-updates..."
                echo ""

                if systemctl is-enabled --quiet digital-twin-autoupdate.timer 2>/dev/null; then
                    sudo systemctl stop digital-twin-autoupdate.timer
                    sudo systemctl disable digital-twin-autoupdate.timer
                    echo "âœ… Auto-updates disabled"
                else
                    echo "âš ï¸  Auto-updates not enabled"
                fi
                echo ""
                ;;
            "now")
                # Run update check now
                echo ""
                echo "ğŸ”„ Running update check..."
                echo ""
                "$SCRIPT_DIR/auto-update.sh"
                ;;
            "status")
                # Check auto-update status
                echo ""
                echo "ğŸ”„ Auto-Update Status"
                echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
                echo ""

                if systemctl is-active --quiet digital-twin-autoupdate.timer 2>/dev/null; then
                    echo "âœ… Status: Enabled"
                    echo ""
                    systemctl status digital-twin-autoupdate.timer --no-pager | head -15
                    echo ""
                    echo "Next run:"
                    systemctl list-timers digital-twin-autoupdate.timer --no-pager
                elif command -v systemctl &> /dev/null; then
                    echo "âŒ Status: Disabled"
                    echo ""
                    echo "To enable:"
                    echo "  dt-setup auto-update enable [hourly|daily|weekly]"
                else
                    echo "âš ï¸  systemd not available"
                    echo ""
                    echo "Check cron jobs:"
                    echo "  crontab -l | grep auto-update"
                fi
                echo ""
                ;;
            *)
                echo ""
                echo "Usage: dt-setup auto-update <command>"
                echo ""
                echo "Commands:"
                echo "  enable [frequency]  Enable auto-updates (hourly/daily/weekly)"
                echo "  disable             Disable auto-updates"
                echo "  now                 Run update check now"
                echo "  status              Check auto-update status"
                echo ""
                echo "Examples:"
                echo "  dt-setup auto-update enable daily    # Enable daily updates"
                echo "  dt-setup auto-update enable weekly   # Enable weekly updates"
                echo "  dt-setup auto-update now             # Check for updates now"
                echo ""
                ;;
        esac
        ;;
    "talents")
        # Show talent catalog
        python3 -c "
import sys
sys.path.insert(0, '$SCRIPT_DIR')
from src.core.talents.catalog import TalentCatalog
TalentCatalog().print_status()
"
        ;;
    "x"|"twitter")
        echo ""
        echo "ğŸ“± X (Twitter) Talent"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "âš™ï¸  Coming soon!"
        echo ""
        echo "This talent will let your Digital Twin post to X."
        echo "Follow updates: dt-setup auto-update now"
        echo ""
        ;;
    "linkedin")
        echo ""
        echo "ğŸ“± LinkedIn Talent"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "âš™ï¸  Coming soon!"
        echo ""
        echo "This talent will let your Digital Twin post to LinkedIn."
        echo "Follow updates: dt-setup auto-update now"
        echo ""
        ;;
    "whatsapp")
        echo ""
        echo "ğŸ“¡ WhatsApp Talent"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "âš™ï¸  Coming soon!"
        echo ""
        echo "This talent will let your Digital Twin send WhatsApp messages."
        echo "Follow updates: dt-setup auto-update now"
        echo ""
        ;;
    "reminders")
        echo ""
        echo "ğŸ“… Reminders & ToDo Talent"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "âš™ï¸  Coming soon!"
        echo ""
        echo "This talent will let your Digital Twin manage reminders and to-do lists."
        echo "Follow updates: dt-setup auto-update now"
        echo ""
        ;;
    "maps"|"restaurants")
        echo ""
        echo "ğŸ” Find Places Talent"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "âš™ï¸  Coming soon!"
        echo ""
        echo "This talent will let your Digital Twin find restaurants and places via Google Maps."
        echo "Follow updates: dt-setup auto-update now"
        echo ""
        ;;
    "github")
        echo ""
        echo "ğŸ’» GitHub Talent"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo ""
        echo "âš™ï¸  Coming soon!"
        echo ""
        echo "This talent will let your Digital Twin manage GitHub repos, issues, and PRs."
        echo "Follow updates: dt-setup auto-update now"
        echo ""
        ;;
    "--help"|"-h"|"help")
        # Show help
        cat << EOF
Digital Twin Setup - Complete Automation

ONE command does everything:
  1. âœ… Installs itself globally (first run)
  2. âœ… Installs Python dependencies
  3. âœ… Runs interactive configuration
  4. âœ… Auto-detects email providers
  5. âœ… Updates .env file
  6. âœ… Ready to run!

Usage:
  dt-setup                Full setup wizard (all tools)

  Bot Management:
  dt-setup start          Start the bot
  dt-setup stop           Stop the bot
  dt-setup restart        Restart the bot
  dt-setup status         Check bot status

  Talents (Capabilities):
  dt-setup talents        List all talents and their status

  Configure Talents:
  dt-setup core           Configure API keys
  dt-setup telegram       Configure Telegram
  dt-setup email          Configure Email talent
  dt-setup calendar       Configure Calendar talent
  dt-setup tunnel         Configure Cloudflare Tunnel
  dt-setup x              X (Twitter) â€” coming soon
  dt-setup linkedin       LinkedIn â€” coming soon
  dt-setup whatsapp       WhatsApp â€” coming soon
  dt-setup reminders      Reminders & ToDo â€” coming soon
  dt-setup maps           Find Places â€” coming soon
  dt-setup github         GitHub â€” coming soon

  Tunnel Management:
  dt-setup tunnel-start   Start Cloudflare Tunnel
  dt-setup tunnel-stop    Stop Cloudflare Tunnel
  dt-setup tunnel-status  Check tunnel status

  Auto-Update:
  dt-setup auto-update enable [freq]  Enable auto-updates (hourly/daily/weekly)
  dt-setup auto-update disable        Disable auto-updates
  dt-setup auto-update now            Check for updates now
  dt-setup auto-update status         Check auto-update status

Examples:
  dt-setup                          # Full wizard
  dt-setup talents                  # View all talents
  dt-setup start                    # Start the bot
  dt-setup email                    # Configure Email talent
  dt-setup calendar                 # Configure Calendar talent
  dt-setup auto-update enable daily # Enable daily auto-updates

First-time setup (TWO commands!):
  git clone https://github.com/AmplifyCo/digital-twin.git
  cd digital-twin && ./dt-setup

  That's it! The script:
  â€¢ Installs itself globally
  â€¢ Installs all dependencies
  â€¢ Asks for Claude API key
  â€¢ Asks for Gmail credentials (optional)
  â€¢ Configures everything
  â€¢ Offers to start the bot immediately
  â€¢ Bot is running!

After first run:
  dt-setup                # Works from anywhere (like git, python)

For advanced options:
  python3 configure.py --help

EOF
        ;;
    *)
        # Unknown argument - pass through to configure.py
        python3 "$CONFIGURE_PY" "$@"
        ;;
esac
