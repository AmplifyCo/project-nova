agent:
  name: "AutonomousCodeBuilder"
  version: "1.0.0"

  execution:
    max_iterations: 50
    timeout_seconds: 300
    retry_attempts: 3

  models:
    # Multi-tier cloud model configuration (PRIMARY - when API works)
    # Safe to commit to git - no credentials here
    default: "claude-opus-4-6"      # Architect - complex planning & orchestration
    subagent: "claude-sonnet-4-5"   # Workers - building & implementation
    chat: "claude-haiku-4-5"        # Chat - conversation (fast, efficient)
    intent: "claude-haiku-4-5"      # Intent parsing - lightweight NLP (fallback if no Gemini)
    gemini_flash: "gemini/gemini-2.0-flash"  # Intent + simple chat (when GEMINI_API_KEY set)

  safety:
    max_file_size_mb: 10
    allow_sudo: true  # Enable limited sudo access
    allowed_sudo_commands:
      # Package management
      - sudo yum install
      - sudo yum update
      - sudo yum remove
      - sudo apt-get install
      - sudo apt-get update
      - sudo apt install
      - sudo apt update
      - sudo pip install
      # Service management
      - sudo systemctl restart digital-twin
      - sudo systemctl status
      # Firewall
      - sudo firewall-cmd
      # Logs
      - sudo journalctl
    # ALLOWLIST DISABLED - Using blocklist-only approach
    # Empty list = allow all commands except those explicitly blocked below
    # This is more flexible and requires less maintenance
    allowed_commands: []
    # BLOCKLIST - Explicitly dangerous commands to prevent
    # Everything else is allowed
    blocked_commands:
      # Destructive file operations
      - rm -rf /
      - rm -rf /*
      - rm -rf ~
      - sudo rm -rf
      - sudo rm
      - rm -r /
      # Command injection bypass attempts
      - bash -c "rm
      - sh -c "rm
      - eval rm
      # System control
      - sudo shutdown
      - sudo reboot
      - sudo poweroff
      - sudo halt
      - sudo init
      # Disk operations
      - format
      - mkfs
      - dd if=/dev/zero
      - dd if=/dev/random
      - sudo dd
      # Process/user management
      - sudo kill -9 1
      - sudo killall
      - sudo userdel
      - sudo deluser
      - sudo passwd
      # Network attacks
      - ":(){ :|:& };"  # fork bomb
      - sudo iptables -F  # flush firewall rules
      # Sensitive file access
      - cat /etc/shadow
      - cat /etc/passwd
      - cat ~/.ssh/id_rsa
      - cp /etc/shadow
      # Cron/scheduled tasks (could persist malicious code)
      - crontab -e
      - sudo crontab
      # LAYER 14: Self-Protection - Block modifications to security files
      - src/core/security/llm_security.py
      - src/core/security/audit_logger.py
      - src/core/security/
      - config/agent.yaml
      - logs/security_audit.jsonl
      - vim src/core/security
      - nano src/core/security
      - rm src/core/security
      - rm config/agent.yaml
      - rm logs/security_audit.jsonl

  # LAYER 11: SEMANTIC VALIDATION
  # Validates that tool use makes semantic sense given user's message
  # Uses Claude Haiku for fast, cheap validation before executing dangerous tools
  semantic_validation:
    enabled: false  # Set to true to enable (adds latency but increases security)
    dangerous_tools:  # Only validate these tools (not all tools)
      - bash
      - file_write
    model: "claude-haiku-4-5"  # Fast, cheap model for validation

brain:
  vector_db:
    type: "chromadb"
    collection_name: "agent_memory"
    embedding_model: "all-MiniLM-L6-v2"

  memory:
    max_context_tokens: 180000
    auto_summarize: true
    retention_days: 90

tools:
  enabled:
    - bash
    - file
    - web
    - browser

monitoring:
  telegram:
    enabled: true
    send_progress_updates: true
    send_errors: true

  dashboard:
    enabled: true
    host: "0.0.0.0"
    port: 18789

local_model:
  # ============================================================================
  # LOCAL MODELS - FALLBACK ONLY (CPU Inference)
  # ============================================================================
  # ⚠️  IMPORTANT: These models are FALLBACK ONLY
  # Used when Claude API fails (rate limits, timeouts, outages)
  # Normal operation uses Claude models: Opus (architect), Sonnet (builder), Haiku (chat)
  #
  # This file is committed to git - it contains model names, not credentials
  # Override endpoints in .env if using remote servers:
  #   LOCAL_MODEL_ENDPOINT=http://localhost:8000
  #   LOCAL_CODER_ENDPOINT=http://localhost:8001

  # Fallback Model: SmolLM2-1.7B
  # Activated ONLY when: Claude API rate limit (429), timeout, or unavailable
  # NOT used during normal operations
  enabled: true  # true = fallback enabled, false = fail if API down
  name: "HuggingFaceTB/SmolLM2-1.7B-Instruct"
  # Alternative options:
  #   - HuggingFaceTB/SmolLM2-360M-Instruct (ultra-fast, 2GB RAM)
  #   - microsoft/Phi-3-mini-4k-instruct (alternative, 8GB RAM)
  endpoint: null  # null = direct inference, or set in .env for server
  use_for: "fallback"  # ONLY as fallback, not primary
  max_tokens: 512
  temperature: 0.7
  device: "cpu"

  # Fallback Coder: DeepSeek-R1-Distill-Qwen-1.5B
  # Activated ONLY when: Claude API fails during code tasks
  # NOT used during normal operations
  coder:
    enabled: true  # true = fallback enabled, false = fail if API down
    name: "deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"
    # Alternative options:
    #   - Qwen/Qwen2.5-Coder-1.5B-Instruct (Qwen coding variant)
    #   - HuggingFaceTB/SmolLM2-1.7B-Instruct (use SmolLM2 for simple code)
    endpoint: null  # null = direct inference, or set in .env for server
    use_for: "fallback"  # ONLY as fallback, not primary
    max_tokens: 1024
    temperature: 0.3  # Lower temperature for precise code

auto_update:
  enabled: true
  schedule: "daily"  # daily, weekly, or cron syntax
  security_only: true  # Only update packages with security vulnerabilities
  notify_telegram: true  # Send Telegram notifications about updates
  auto_restart: true  # Restart agent after applying updates

  packages:
    system: true  # Update system packages (yum/apt)
    python: true  # Update Python packages (pip)

  vulnerability_scanning:
    enabled: true
    tools:
      - pip-audit  # Primary scanner
      - safety  # Fallback scanner
